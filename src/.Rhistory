knitr::opts_chunk$set(echo = T, message = F)
library(tidyverse)
library(tmap)
library(sf)
t.names <- tibble(key = c(1, 2, 3), name = c("Huey", "Dewey", "Louis"))
t.scores <- tibble(name = c("Louis", "Huey", "Dewey"), grade = c(99, 45, 33))
t.joined <- left_join(t.names, t.scores, by = "name")
t.joined
t.wonkyNames <- tibble(nombre = c("Dewey", "Louis", "Huey"), x = rep(999),
favoriteFood = c("banana", "apple", "carrot"))
t.joined2 <- left_join(t.names, t.wonkyNames, by = c("name" = "nombre"))
t.joined2
bmps <- read_csv("../data/CBW/BMPreport2016_landbmps.csv")
glimpse(bmps)
bmps <- bmps %>% mutate(., FIPS.trimmed = stringr::str_sub(GeographyName, 1, 5))
glimpse(bmps)
bmps %>% group_by(BMPType) %>% summarise(totalCost = sum(Cost)) %>%
ggplot(., aes(x = BMPType, y = totalCost)) +
geom_bar(stat = "identity") +
theme_minimal()
summary(bmps$Cost)
bmps %>% group_by(BMPType) %>% summarise(totalCost = sum(Cost, na.rm = T)) %>%
ggplot(., aes(x = BMPType, y = totalCost)) +
geom_bar(stat = "identity") +
theme_minimal()
twofactors <- bmps %>% group_by(StateAbbreviation, Sector) %>% summarise(totalCost = sum(Cost))
twofactors
bmps %>% ggplot(., aes(x = StateAbbreviation, y = AmountCredited)) +
geom_boxplot(aes(fill = StateAbbreviation))
bmps %>%
dplyr::filter(., AmountCredited > 1 & AmountCredited < 100) %>%
ggplot(., aes(x = StateAbbreviation, y = AmountCredited)) +
geom_boxplot(aes(fill = StateAbbreviation))
bmps %>%
dplyr::filter(., AmountCredited > 1 & AmountCredited < 100) %>%
ggplot(., aes(x = StateAbbreviation, y = AmountCredited)) +
geom_boxplot(aes(fill = StateAbbreviation)) +
facet_grid(Sector~.)
x <- c(1, 2, 3, 4, 5)
7 %in% x
2 %in% x
c(4, 99, 1) %in% x
counties <- sf::read_sf("../data/CBW/County_Boundaries.shp")
counties %>% sf::st_is_valid()
counties <- counties %>% sf::st_make_valid()
tm_shape(counties) + tm_polygons(col = "ALAND10")
# load data
counties <- sf::read_sf("../data/CBW/County_Boundaries.shp") %>% sf::st_make_valid()
dams <- sf::read_sf("../data/CBW/Dam_or_Other_Blockage_Removed_2012_2017.shp") %>% sf::st_make_valid()
streams <- sf::read_sf("../data/CBW/Streams_Opened_by_Dam_Removal_2012_2017.shp") %>% sf::st_make_valid()
bmps <- read_csv("../data/CBW/BMPreport2016_landbmps.csv")
totalC <- bmps %>% group_by(StateAbbreviation) %>% summarise(Cost)
by(totalC, totalC$StateAbbreviation, summary)
options(scipen = 5)
acres.bmps <- bmps %>% dplyr::filter(Unit == 'Acres', Cost > 0 & Cost < 100000, TotalAmountCredited > 300 & TotalAmountCredited < 30000)
p1 <- ggplot(acres.bmps, aes(x=Cost, y=TotalAmountCredited)) +
geom_point(size=1) + labs(x= "Cost",
y="TotalAmountCredited",
title = "Cost vs. TotalAmountCredited")
p1
detect.bmps <- bmps %>% mutate(., findCC = stringr::str_detect(BMP, "Cover Crop", negate = F))
filter.bmps <- detect.bmps %>% dplyr::filter(findCC == T, TotalAmountCredited > 1 & TotalAmountCredited < 100)
p2 <- filter.bmps %>% ggplot(., aes(x = StateAbbreviation, y = TotalAmountCredited)) + geom_boxplot(aes(fill = StateAbbreviation))
p2
filter.dams <- dams %>% dplyr::filter(YEAR > 1000)
p3 <- ggplot(filter.dams, aes(x=YEAR, y=STATE, label = DAM_NAME, color = DAM_NAME)) +
geom_point(size=3) + labs(x= "Year",
y="State",
title = "Year of Completion (Dam)")
p3 + geom_text(hjust = 0.3, vjust = 1.5, nudge_x = 0, angle = 90, size = 3)
p4 <- ggplot() + geom_rect(data=filter.dams, aes(xmin=YEAR, xmax=DamRemoval, ymin=DAM_NAME, ymax=DAM_NAME, color=DAM_NAME),size=10) +
labs(x= "Year", y="", title = "Service Life of Dams")
p4 + geom_label(data = filter.dams, aes(x = YEAR + (DamRemoval-YEAR)/2, y = DAM_NAME, label = paste(DamRemoval-YEAR, "Years")))
long.streams <- streams %>% as_tibble() %>% dplyr::select(-geometry) %>% group_by(GNIS_Name) %>% summarise(totalLength = sum(LengthKM))
na.long.streams <- na.omit(long.streams)
s.long.streams <- arrange(na.long.streams, desc(totalLength))
head(s.long.streams, 5)
joined <- st_join(streams, counties, join = st_intersects)
long.joined <- joined %>% as_tibble() %>% dplyr::select(-geometry) %>% group_by(NAME10) %>% summarise(totalLength = sum(LengthKM))
s.long.streams <- arrange(long.joined, desc(totalLength))
head(s.long.streams, 3)
bmps <- bmps %>% mutate(., FIPS.trimmed = stringr::str_sub(GeographyName, 1, 2))
df <- left_join(counties %>% as.data.frame(), bmps %>% as.data.frame(), by = c("STATEFP10" = "FIPS.trimmed"))
View(dams)
View(bmps)
View(bmps)
View(counties)
View(counties)
st_disjoint(counties)
View(counties)
View(counties)
p4 <- ggplot() + geom_rect(data=filter.dams, aes(xmin=YEAR, xmax=DamRemoval, ymin=DAM_NAME, ymax=DAM_NAME, color=DAM_NAME),size=10) +
labs(x= "Year", y="", title = "Service Life of Dams")
p4 + geom_label(data = filter.dams, aes(x = YEAR + (DamRemoval-YEAR)/2, y = DAM_NAME, label = paste(DamRemoval-YEAR, "Years")))
View(joined)
View(joined)
View(streams)
st_disjoint(streams)
View(streams)
View(streams)
disjoin(steams)
# load data
counties <- sf::read_sf("../data/CBW/County_Boundaries.shp") %>% sf::st_make_valid()
dams <- sf::read_sf("../data/CBW/Dam_or_Other_Blockage_Removed_2012_2017.shp") %>% sf::st_make_valid()
streams <- sf::read_sf("../data/CBW/Streams_Opened_by_Dam_Removal_2012_2017.shp") %>% sf::st_make_valid()
bmps <- read_csv("../data/CBW/BMPreport2016_landbmps.csv")
View(streams)
View(streams)
disjoin(dams)
disjoint
disjoint(dams)
disjoin_dams
long.streams <- streams %>% as_tibble() %>% dplyr::select(-geometry) %>% group_by(GNIS_Name) %>% summarise(totalLength = sum(LengthKM))
knitr::opts_chunk$set(echo = T, message = F)
library(tidyverse)
library(tmap)
library(sf)
t.names <- tibble(key = c(1, 2, 3), name = c("Huey", "Dewey", "Louis"))
t.scores <- tibble(name = c("Louis", "Huey", "Dewey"), grade = c(99, 45, 33))
t.joined <- left_join(t.names, t.scores, by = "name")
t.joined
t.wonkyNames <- tibble(nombre = c("Dewey", "Louis", "Huey"), x = rep(999),
favoriteFood = c("banana", "apple", "carrot"))
t.joined2 <- left_join(t.names, t.wonkyNames, by = c("name" = "nombre"))
t.joined2
bmps <- read_csv("../data/CBW/BMPreport2016_landbmps.csv")
glimpse(bmps)
bmps <- bmps %>% mutate(., FIPS.trimmed = stringr::str_sub(GeographyName, 1, 5))
glimpse(bmps)
bmps %>% group_by(BMPType) %>% summarise(totalCost = sum(Cost)) %>%
ggplot(., aes(x = BMPType, y = totalCost)) +
geom_bar(stat = "identity") +
theme_minimal()
summary(bmps$Cost)
bmps %>% group_by(BMPType) %>% summarise(totalCost = sum(Cost, na.rm = T)) %>%
ggplot(., aes(x = BMPType, y = totalCost)) +
geom_bar(stat = "identity") +
theme_minimal()
twofactors <- bmps %>% group_by(StateAbbreviation, Sector) %>% summarise(totalCost = sum(Cost))
twofactors
bmps %>% ggplot(., aes(x = StateAbbreviation, y = AmountCredited)) +
geom_boxplot(aes(fill = StateAbbreviation))
bmps %>%
dplyr::filter(., AmountCredited > 1 & AmountCredited < 100) %>%
ggplot(., aes(x = StateAbbreviation, y = AmountCredited)) +
geom_boxplot(aes(fill = StateAbbreviation))
bmps %>%
dplyr::filter(., AmountCredited > 1 & AmountCredited < 100) %>%
ggplot(., aes(x = StateAbbreviation, y = AmountCredited)) +
geom_boxplot(aes(fill = StateAbbreviation)) +
facet_grid(Sector~.)
x <- c(1, 2, 3, 4, 5)
7 %in% x
2 %in% x
c(4, 99, 1) %in% x
counties <- sf::read_sf("../data/CBW/County_Boundaries.shp")
counties %>% sf::st_is_valid()
counties <- counties %>% sf::st_make_valid()
tm_shape(counties) + tm_polygons(col = "ALAND10")
# load data
counties <- sf::read_sf("../data/CBW/County_Boundaries.shp") %>% sf::st_make_valid()
dams <- sf::read_sf("../data/CBW/Dam_or_Other_Blockage_Removed_2012_2017.shp") %>% sf::st_make_valid()
streams <- sf::read_sf("../data/CBW/Streams_Opened_by_Dam_Removal_2012_2017.shp") %>% sf::st_make_valid()
bmps <- read_csv("../data/CBW/BMPreport2016_landbmps.csv")
totalC <- bmps %>% group_by(StateAbbreviation) %>% summarise(Cost)
by(totalC, totalC$StateAbbreviation, summary)
options(scipen = 5)
acres.bmps <- bmps %>% dplyr::filter(Unit == 'Acres', Cost > 0 & Cost < 100000, TotalAmountCredited > 300 & TotalAmountCredited < 30000)
p1 <- ggplot(acres.bmps, aes(x=Cost, y=TotalAmountCredited)) +
geom_point(size=1) + labs(x= "Cost",
y="TotalAmountCredited",
title = "Cost vs. TotalAmountCredited")
p1
detect.bmps <- bmps %>% mutate(., findCC = stringr::str_detect(BMP, "Cover Crop", negate = F))
filter.bmps <- detect.bmps %>% dplyr::filter(findCC == T, TotalAmountCredited > 1 & TotalAmountCredited < 100)
p2 <- filter.bmps %>% ggplot(., aes(x = StateAbbreviation, y = TotalAmountCredited)) + geom_boxplot(aes(fill = StateAbbreviation))
p2
filter.dams <- dams %>% dplyr::filter(YEAR > 1000)
p3 <- ggplot(filter.dams, aes(x=YEAR, y=STATE, label = DAM_NAME, color = DAM_NAME)) +
geom_point(size=3) + labs(x= "Year",
y="State",
title = "Year of Completion (Dam)")
p3 + geom_text(hjust = 0.3, vjust = 1.5, nudge_x = 0, angle = 90, size = 3)
t.joined3 <- left_join(streams, dams, by = c("name" = "nombre"))
View(streams)
View(streams)
View(dams)
View(dams)
t.joined3 <- left_join(streams, dams, by = c("COMID" = "COMID"))
t.joined3 <- left_join(streams, dams, by = c("Comid" = "COMID"))
dams1 <- dams %>% as_tibble() %>% dplyr::select(-geometry)
t.joined3 <- left_join(streams, dams, by = c("Comid" = "COMID"))
t.joined3 <- left_join(streams, dams1, by = c("Comid" = "COMID"))
t.joined3 <- left_join(streams, dams1, by = c("COMID" = "COMID"))
View(dams1)
View(dams1)
dams1 <- dams %>% as_tibble() %>% dplyr::select(-geometry)
t.joined3 <- left_join(streams, dams1, by = c("COMID" = "COMID"))
t.joined3 <- left_join(streams, dams1, by = c("COMID" = "ComID"))
t.joined3 <- left_join(streams, dams1, by = c("ComID" = "COMID"))
t.joined2
t.joined3
p4 <- ggplot() + geom_rect(data=t.joined3, aes(xmin=YEAR, xmax=DamRemoval, ymin=DAM_NAME, ymax=DAM_NAME, color=DAM_NAME),size=10) +
labs(x= "Year", y="", title = "Service Life of Dams")
p4 + geom_label(data = filter.dams, aes(x = YEAR + (DamRemoval-YEAR)/2, y = DAM_NAME, label = paste(DamRemoval-YEAR, "Years")))
t.joined3
View(dams)
View(dams)
knitr::opts_chunk$set(echo = T, message = F)
library(tidyverse)
library(tmap)
library(sf)
knitr::opts_chunk$set(echo = T, message = F)
library(tidyverse)
library(tmap)
library(sf)
# load data
counties <- sf::read_sf("../data/CBW/County_Boundaries.shp") %>% sf::st_make_valid()
dams <- sf::read_sf("../data/CBW/Dam_or_Other_Blockage_Removed_2012_2017.shp") %>% sf::st_make_valid()
streams <- sf::read_sf("../data/CBW/Streams_Opened_by_Dam_Removal_2012_2017.shp") %>% sf::st_make_valid()
bmps <- read_csv("../data/CBW/BMPreport2016_landbmps.csv")
totalC <- bmps %>% group_by(StateAbbreviation) %>% summarise(Cost)
by(totalC, totalC$StateAbbreviation, summary)
options(scipen = 5)
acres.bmps <- bmps %>% dplyr::filter(Unit == 'Acres', Cost > 0 & Cost < 100000, TotalAmountCredited > 300 & TotalAmountCredited < 30000)
p1 <- ggplot(acres.bmps, aes(x=Cost, y=TotalAmountCredited)) +
geom_point(size=1) + labs(x= "Cost",
y="TotalAmountCredited",
title = "Cost vs. TotalAmountCredited")
p1
detect.bmps <- bmps %>% mutate(., findCC = stringr::str_detect(BMP, "Cover Crop", negate = F))
filter.bmps <- detect.bmps %>% dplyr::filter(findCC == T, TotalAmountCredited > 1 & TotalAmountCredited < 100)
p2 <- filter.bmps %>% ggplot(., aes(x = StateAbbreviation, y = TotalAmountCredited)) + geom_boxplot(aes(fill = StateAbbreviation))
p2
filter.dams <- dams %>% dplyr::filter(YEAR > 1000)
p3 <- ggplot(filter.dams, aes(x=YEAR, y=STATE, label = DAM_NAME, color = DAM_NAME)) +
geom_point(size=3) + labs(x= "Year",
y="State",
title = "Year of Completion (Dam)")
p3 + geom_text(hjust = 0.3, vjust = 1.5, nudge_x = 0, angle = 90, size = 3)
dams1 <- dams %>% as_tibble() %>% dplyr::select(-geometry)
bmps1 <- bmps %>% group_by(StateAbbreviation) %>% summarise(tcost = sum(Cost, na.rm = T))
t.joined3 <- left_join(dams1, bmps1, by = c("STATE" = "StateAbbreviation"))
filter.dams <- t.joined3 %>% dplyr::filter(YEAR > 1000)
filter.dams$tcost <- round(filter.dams$tcost, 0)
filter.dams$DAM_STATE <- paste(DAM_STATE = filter.dams$DAM_NAME,",", filter.dams$STATE, "- Total Cost of BMP: $", filter.dams$tcost)
p4 <- ggplot() + geom_rect(data=filter.dams, aes(xmin=YEAR, xmax=DamRemoval, ymin=DAM_STATE, ymax=DAM_STATE, color=DAM_STATE),size=10) +
labs(x= "Year", y="", title = "Service Life of Dams & Cost of BMPs by State")
p4 + geom_label(data = filter.dams, aes(x = YEAR + (DamRemoval-YEAR)/2, y = DAM_STATE, label = paste(DamRemoval-YEAR, "Years"))) + theme(legend.position="none")
long.streams <- streams %>% as_tibble() %>% dplyr::select(-geometry) %>% group_by(GNIS_Name) %>% summarise(totalLength = sum(LengthKM))
na.long.streams <- na.omit(long.streams)
s.long.streams <- arrange(na.long.streams, desc(totalLength))
head(s.long.streams, 5)
joined <- st_join(streams, counties, join = st_intersects)
long.joined <- joined %>% as_tibble() %>% dplyr::select(-geometry) %>% group_by(NAME10) %>% summarise(totalLength = sum(LengthKM))
s.long.streams <- arrange(long.joined, desc(totalLength))
head(s.long.streams, 3)
bmps_trim <- bmps %>% mutate(., FIPS.trimmed = stringr::str_sub(GeographyName, 3, 5)) %>% group_by(FIPS.trimmed) %>% summarise(tcost = sum(Cost, na.rm = T))
counties_bmps <- left_join(counties, bmps_trim, by = c("COUNTYFP10" = "FIPS.trimmed"))
counties_bmps$tcost <- as.integer(counties_bmps$tcost)
tm_shape(counties_bmps) + tm_polygons(col = "tcost") + tm_layout(title = "Total Cost of BMPs by County",legend.outside = TRUE)
nearest <- st_nearest_feature(dams, streams)
dsjoin <- cbind(dams, st_drop_geometry(streams)[nearest,])
nearpts <- dsjoin %>% mutate(ClosestStreamID = OBJECTID_1.1) %>% summarise(DAM_NAME, ClosestStreamID, geometry, GNIS_Name)
print(nearpts, n=40)
dams %>% group_by(STATE) %>% summarise(count = n()) %>% arrange(desc(count))
View(streams)
